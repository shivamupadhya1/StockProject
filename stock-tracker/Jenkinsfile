pipeline {
    agent any
    stages {
        stage('Build') {
            steps {
                dir('stock-tracker') {
                    script {
                        echo 'Building the project...'
                        bat 'mvn clean install'
                    }
                }
            }
        }
        stage('Nexus Deploy') {
            steps {
				dir('stock-tracker') {
					script{
						echo 'Deploying....'
						def mavenPom = readMavenPom file: 'pom.xml'
						nexusArtifactUploader(
							nexusVersion: 'nexus3',
							protocol: 'http',
							nexusUrl: 'localhost:8090',
							groupId: "${mavenPom.groupId}",
							version: "${mavenPom.version}",
							repository: 'INTEGRATIONS_CLIENT',
							credentialsId: 'NEXUS_CRED',
							artifacts: [
								[artifactId: "${mavenPom.artifactId}",
								 classifier: '',
								 file: "./target/${mavenPom.artifactId}-${mavenPom.version}.war",
								 type: 'jar'],
								 [artifactId: "${mavenPom.artifactId}",
								  classifier: '',
								  file: "pom.xml",
								  type: "pom"]
							]
						 )
					 }
				}
            }
        }
	stage('JBoss Deployment') {
	    steps {
	        dir('integration_clients') {
	            withCredentials([usernamePassword(credentialsId: 'JBOSS_CRED', usernameVariable: 'JBOSS_CRED_USER', passwordVariable: 'JBOSS_CRED_PASSWORD')]) {
	                script {
	                    echo 'Deploying to JBoss....'
	
	                    // Add your JBoss deployment script or command here
	                    // Example: Use the JBoss CLI to deploy the WAR file
	                    lastChanges since: 'LAST_SUCCESSFUL_BUILD', format:'SIDE', matching: 'LINE'
	                    sh 'mvn wildfly:deploy-only -Dwildfly.username=${JBOSS_CRED_USER} -Dwildfly.password=${JBOSS_CRED_PASSWORD}'
	                }
	            }
	        }
	    }
	}

    }

    post {
        success {
            echo 'Build succeeded!'
        }
        failure {
            echo 'Build failed!'
        }
    }
}
